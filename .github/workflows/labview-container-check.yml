name: Regression Gates on Linux Container

on:
  pull_request:
    types:
      - opened
      - synchronize
      - reopened

jobs:
  run-labview-cli:
    runs-on: ubuntu-latest
    env:
      LABVIEW_IMAGE_LINUX: nationalinstruments/labview:2026q1-linux
      LABVIEW_YEAR: "2026"
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Pull LabVIEW container image (pinned)
        run: docker pull ${{ env.LABVIEW_IMAGE_LINUX }}

      - name: "Gate 1 (Examples): MassCompile Arrays"
        run: |
          docker run --rm \
            ${{ env.LABVIEW_IMAGE_LINUX }} \
            bash -c "LabVIEWCLI -OperationName MassCompile -DirectoryToCompile /usr/local/natinst/LabVIEW-${LABVIEW_YEAR}-64/examples/Arrays -LabVIEWPath /usr/local/natinst/LabVIEW-${LABVIEW_YEAR}-64/labview -Headless"

      - name: "Gate 2 (Examples): Run integration script"
        run: |
          docker run --rm \
            -v "${{ github.workspace }}:/workspace" \
            ${{ env.LABVIEW_IMAGE_LINUX }} \
            bash -c "cd /workspace/examples/integration-into-cicd && chmod +x runlabview.sh && LV_YEAR=${LABVIEW_YEAR} ./runlabview.sh"

